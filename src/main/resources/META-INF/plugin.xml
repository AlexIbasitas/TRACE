<!-- TRACE: Cucumber Test Failure Triage Assistant -->
<idea-plugin>
    <id>com.trace</id>
    <name>TRACE</name>
    <vendor>Alex Ibasitas</vendor>
    <description><![CDATA[
        <p>TRACE is an intelligent test failure analysis assistant for Cucumber Java tests in IntelliJ IDEA.</p>
        
        <h3>Key Features:</h3>
        <ul>
            <li><b>Automatic Failure Detection</b> - Automatically captures and analyzes Cucumber test failures</li>
            <li><b>AI-Powered Analysis</b> - Get intelligent suggestions for fixing test failures using OpenAI or Google Gemini</li>
            <li><b>Context Extraction</b> - Extracts step definitions, Gherkin scenarios, and stack traces automatically</li>
            <li><b>Chat Interface</b> - Interactive chat interface for asking follow-up questions about failures</li>
            <li><b>Secure API Management</b> - Secure storage of API keys using IntelliJ's PasswordSafe</li>
        </ul>
        
        <h3>How It Works:</h3>
        <p>When a Cucumber test fails, TRACE automatically:</p>
        <ol>
            <li>Extracts the failure information and stack trace</li>
            <li>Finds the corresponding step definition and Gherkin scenario</li>
            <li>Generates an AI prompt with all relevant context</li>
            <li>Displays the analysis in an easy-to-read chat interface</li>
        </ol>
        
        <h3>Perfect For:</h3>
        <ul>
            <li>SDETs and QA Engineers working with Cucumber tests</li>
            <li>Teams using Behavior-Driven Development (BDD)</li>
            <li>Developers who want faster test failure triage</li>
        </ul>
        
        <p><b>Note:</b> Requires OpenAI API key or Google Gemini API key for AI analysis features.</p>
    ]]></description>

    <idea-version since-build="252" until-build="252.*"/>

    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.java</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Custom Icon -->
        <icon path="/icons/trace_logo.png" id="TRACE.Icon"/>
        
        <!-- Tool Window -->
        <toolWindow id="AI Assistant"
                   name="TRACE"
                   secondary="false" 
                   icon="icons/logo_13.png" 
                   anchor="right" 
                   factoryClass="com.trace.chat.ui.TriagePanelToolWindowFactory"/>

        <!-- Services -->
        <projectService serviceImplementation="com.trace.ai.services.AINetworkService"/>
        <applicationService serviceImplementation="com.trace.ai.services.AIModelService"/>
        <projectService serviceImplementation="com.trace.ai.services.ChatHistoryService"/>

        <applicationService serviceImplementation="com.trace.ai.prompts.InitialPromptFailureAnalysisService"/>
        <applicationService serviceImplementation="com.trace.ai.configuration.AISettings"/>
    </extensions>

    <applicationListeners>
        <!-- Test Execution Listeners -->
        <listener class="com.trace.test.listeners.CucumberTestExecutionListener"
                  topic="com.intellij.execution.testframework.sm.runner.SMTRunnerEventsListener"/>
    </applicationListeners>
    

</idea-plugin> 